@page "/"

@using dangan.Client.Model;

@inject NavigationManager NavigationManager
@*@inject Blazored.SessionStorage.ISessionStorageService sessionStorage*@

@*<form action="/search" method="post">
        keyword: <input type="text" name="keyword">  <button type="submit">Search</button> <br>
        <select name="lang_select">
            <option value="en">en</option>
            <option value="jp">jp</option>
        </select>

    </form>*@


<EditForm Model="@model" OnValidSubmit="@HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    keyword:<InputText id="keyowrdInput" @bind-Value="model.keyword" />

    <button type="submit">Submit</button> <br>

    <select name="lang_select">
        <option value="en">en</option>
        <option value="jp">jp</option>
    </select>
</EditForm>


@*
    https://www.0daydown.com/04/1611202.html
    https://docs.microsoft.com/en-us/aspnet/core/blazor/forms-validation?view=aspnetcore-5.0
    <input type="text" name="keyword">
    <SurveyPrompt Title="How is Blazor working for you?" />
*@


@code {

    private static readonly HttpClient client = new HttpClient();

    KeywordModel model = new KeywordModel();

    private async void HandleSubmit()
    {
        string keyword = model.keyword;

        //发送Post请求
        var values = new Dictionary<string, string>
        {
            { "keyword", "a" },
            { "lang_select", "b" }
        };

        var content = new FormUrlEncodedContent(values);
        var response = await client.PostAsync("http://localhost:5000/search", content);
        var responseString = await response.Content.ReadAsStringAsync();

        MethodToTriggerUrl();  // jump to page x
    }



    void MethodToTriggerUrl()
    {
        NavigationManager.NavigateTo("/");
    }
}